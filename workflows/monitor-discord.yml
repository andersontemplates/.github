name: Monitoramento Discord

on:
  issues:
    types: [opened, closed, reopened]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened, closed, reopened, merged]
  release:
    types: [published]
  workflow_run:
    types: [completed]
  push:

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Definir mensagem do evento
        id: set-message
        run: |
          EVENT_NAME="${{ github.event_name }}"
          ACTION="${{ github.event.action || 'completed' }}"
          MESSAGE="ðŸ“¢ Novo evento: $EVENT_NAME ($ACTION)"

          case $EVENT_NAME in
            issues)
              MESSAGE="ðŸ› Issue *${{ github.event.issue.title }}* foi $ACTION por ${{ github.actor }}"
              ;;
            issue_comment)
              MESSAGE="ðŸ—¨ï¸ Novo comentÃ¡rio em *${{ github.event.issue.title }}* por ${{ github.actor }}:\n> ${{ github.event.comment.body }}"
              ;;
            pull_request)
              TITLE="${{ github.event.pull_request.title }}"
              URL="${{ github.event.pull_request.html_url }}"
              if [[ "$ACTION" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
                MESSAGE="âœ… PR *$TITLE* foi *mergeado* por ${{ github.actor }}\nðŸ”— $URL"
              else
                MESSAGE="ðŸ“¥ PR *$TITLE* foi $ACTION por ${{ github.actor }}\nðŸ”— $URL"
              fi
              ;;
            release)
              MESSAGE="ðŸš€ Nova release publicada: *${{ github.event.release.name }}*\n${{ github.event.release.html_url }}"
              ;;
            workflow_run)
              STATUS="${{ github.event.workflow_run.conclusion }}"
              MESSAGE="âš™ï¸ Workflow *${{ github.event.workflow_run.name }}* $STATUS para ${{ github.repository }}\nðŸ”— ${{ github.event.workflow_run.html_url }}"
              ;;
            push)
              MESSAGE="ðŸš€ Push feito em *${{ github.ref_name }}* por ${{ github.actor }}\nðŸ”— https://github.com/${{ github.repository }}/commit/${{ github.sha }}"
              ;;
          esac

          echo "message=$MESSAGE" >> "$GITHUB_OUTPUT"

      - name: Enviar para o Discord
        uses: Ilshidur/action-discord@master
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          message: ${{ steps.set-message.outputs.message }}
